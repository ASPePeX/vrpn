#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/cmake.mk
include debian/cdbs/1/rules/buildinfo.mk

# Get the version from the source code, in separate "major" and "minor" components
VER_MAJ := $(shell grep "const char \* vrpn_MAGIC \=" $(CURDIR)/vrpn_Connection.C | sed 's/^[^0-9]*\([0-9]\+\).[0-9]\+[^0-9].*/\1/')
VER_MIN := $(shell grep "const char \* vrpn_MAGIC \=" $(CURDIR)/vrpn_Connection.C | sed 's/^[^0-9]*[0-9]\+.\([0-9]\+\)[^0-9].*/\1/')
SOURCE_VER := $(VER_MAJ).$(VER_MIN)

DEB_DESTDIR := $(CURDIR)/debian/tmp

DEB_INSTALL_DOCS_ALL := $(CURDIR)/README $(CURDIR)/README.Compiling $(CURDIR)/README.Legal

DEB_MAKE_BUILD_TARGET := all doc
DEB_CMAKE_EXTRA_FLAGS := -DVRPN_BUILD_PYTHON=ON

PACKAGE := $(shell dpkg-parsechangelog | sed -n 's/^Source: //p')
get-orig-source:
	rm -rf $@
	mkdir -p $@/$(PACKAGE)-$(SOURCE_VER)
	cd $@ && wget ftp://ftp.cs.unc.edu/pub/packages/GRIP/vrpn/vrpn_$(VER_MAJ)_$(VER_MIN).zip
	unzip -o $@/vrpn_$(VER_MAJ)_$(VER_MIN).zip -d $@/$(PACKAGE)-$(SOURCE_VER)
	cd $@ && tar -cf - $(PACKAGE)-$(SOURCE_VER) | gzip -9f - > ../../$(PACKAGE)_$(SOURCE_VER).orig.tar.gz
	rm -r $@

